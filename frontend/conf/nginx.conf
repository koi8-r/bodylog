user www-data ;
worker_processes auto ;
pid /var/run/nginx.pid ;
daemon off ;
master_process on ;


error_log /var/log/nginx/error.log warn ;

events {
    worker_connections 1024 ;
}


upstream api {
    server: api:8080 ;
}


http {
    sendfile on ;
    include /etc/nginx/mime.types ;
    default_type application/octet-stream ;
    tcp_nopush on ;
    tcp_nodelay on ;
    keepalive_timeout 65 ;
    gzip off ;
    log_format main '$remote_addr [$time_local] "$request"'
                    '' ;
    access_log /var/log/nginx/access.log main ;

    server {
        listen 80 ;
        # access_log /var/log/nginx/SERVERNAME-access.log main ;
        # error_log /var/log/nginx/SERVERNAME-error.log crit ;

        location / {
            root /var/www/html/ ;
            index index.html index.htm ;
        }

        location /api/ {
            proxy_pass http://api ;
        }

        location ~ /\.ht {
            deny all ;
        }
    }

    server {
        listen 80 ;
        server_name api ;

        location / {
            proxy_pass http://api ;
            # proxy_set_header Host $host ;
            # proxy_set_header X-Real-IP $remote_addr ;
            # proxy_set_header X-Forwarded-Host $server_name ;
            # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ;
            # proxy_set_header X-Forwarded-Proto $scheme ;
            # proxy_http_version 1.1 ;
            # proxy_set_header Connection "" ;
            # proxy_buffering off ;
            # proxy_redirect off;
            # proxy_redirect http:// https:// ;
            # proxy_pass_header Set-Cookie ;
        }

        location ~ /\.ht {
            deny all ;
        }
    }
}
